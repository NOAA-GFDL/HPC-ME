FROM condaforge/mambaforge:latest
# condaforge is based oon a stripped down ubuntu image.  We need some extra bits for frerun + fremake
# uuid-runtime gives us /usr/bin/uuidgen
# time gives us /usr/bin/time
RUN apt update && apt -y install uuid-runtime time csh
RUN mkdir /opt/conda/cylc-flow-tools
COPY ./cylc-flow-tools.yaml /opt/conda/cylc-flow-tools
COPY ./macro.py /
RUN mamba env create --file /opt/conda/cylc-flow-tools/cylc-flow-tools.yaml -p /opt/conda/cylc-flow-tools
RUN /bin/bash -c "cp -f /macro.py /opt/conda/cylc-flow-tools/lib/python3.10/site-packages/metomi/rose/macro.py"
RUN git config --global --add safe.directory /mnt2
